!function($){$.fn.fixedHeaderTable=function(method){var defaults={width:"100%",height:"100%",themeClass:"fht-default",borderCollapse:!0,fixedColumns:0,fixedColumn:!1,sortable:!1,autoShow:!0,footer:!1,cloneHeadToFoot:!1,cloneEvents:!1,autoResize:!1,create:null},settings={},methods={init:function(options){return settings=$.extend({},defaults,options),this.each(function(){var $self=$(this);helpers._isTable($self)?(methods.setup.apply(this,Array.prototype.slice.call(arguments,1)),$.isFunction(settings.create)&&settings.create.call(this)):$.error("Invalid table mark-up")})},setup:function(){var $wrapper,$divHead,$divBody,$fixedBody,widthMinusScrollbar,$self=$(this),self=this,$thead=$self.find("thead"),$tfoot=$self.find("tfoot"),tfootHeight=0;settings.originalTable=$(this).clone(),settings.includePadding=helpers._isPaddingIncludedWithWidth(),settings.scrollbarOffset=helpers._getScrollbarWidth(),settings.themeClassName=settings.themeClass,widthMinusScrollbar=settings.width.search("%")>-1?$self.parent().width()-settings.scrollbarOffset:settings.width-settings.scrollbarOffset,$self.css({width:widthMinusScrollbar}),$self.closest(".fht-table-wrapper").length||($self.addClass("fht-table"),$self.wrap('<div class="fht-table-wrapper"></div>')),$wrapper=$self.closest(".fht-table-wrapper"),1==settings.fixedColumn&&settings.fixedColumns<=0&&(settings.fixedColumns=1),settings.fixedColumns>0&&0==$wrapper.find(".fht-fixed-column").length&&($self.wrap('<div class="fht-fixed-body"></div>'),$('<div class="fht-fixed-column"></div>').prependTo($wrapper),$fixedBody=$wrapper.find(".fht-fixed-body")),$wrapper.css({width:settings.width,height:settings.height}).addClass(settings.themeClassName),$self.hasClass("fht-table-init")||$self.wrap('<div class="fht-tbody"></div>'),$divBody=$self.closest(".fht-tbody");var tableProps=helpers._getTableProps($self);helpers._setupClone($divBody,tableProps.tbody),$self.hasClass("fht-table-init")?$divHead=$wrapper.find("div.fht-thead"):($divHead=settings.fixedColumns>0?$('<div class="fht-thead"><table class="fht-table"></table></div>').prependTo($fixedBody):$('<div class="fht-thead"><table class="fht-table"></table></div>').prependTo($wrapper),$divHead.find("table.fht-table").addClass(settings.originalTable.attr("class")).attr("style",settings.originalTable.attr("style")),$thead.clone(settings.cloneEvents).appendTo($divHead.find("table"))),helpers._setupClone($divHead,tableProps.thead),$self.css({"margin-top":-$divHead.outerHeight(!0)}),1==settings.footer&&(helpers._setupTableFooter($self,self,tableProps),$tfoot.length||($tfoot=$wrapper.find("div.fht-tfoot table")),tfootHeight=$tfoot.outerHeight(!0));var tbodyHeight=$wrapper.height()-$thead.outerHeight(!0)-tfootHeight-tableProps.border;return $divBody.css({height:tbodyHeight}),$self.addClass("fht-table-init"),"undefined"!=typeof settings.altClass&&methods.altRows.apply(self),settings.fixedColumns>0&&helpers._setupFixedColumn($self,self,tableProps),settings.autoShow||$wrapper.hide(),helpers._bindScroll($divBody,tableProps),self},resize:function(){var self=this;return self},altRows:function(arg1){var $self=$(this),altClass="undefined"!=typeof arg1?arg1:settings.altClass;$self.closest(".fht-table-wrapper").find("tbody tr:odd:not(:hidden)").addClass(altClass)},show:function(arg1,arg2,arg3){var $self=$(this),self=this,$wrapper=$self.closest(".fht-table-wrapper");return"undefined"!=typeof arg1&&"number"==typeof arg1?($wrapper.show(arg1,function(){$.isFunction(arg2)&&arg2.call(this)}),self):"undefined"!=typeof arg1&&"string"==typeof arg1&&"undefined"!=typeof arg2&&"number"==typeof arg2?($wrapper.show(arg1,arg2,function(){$.isFunction(arg3)&&arg3.call(this)}),self):($self.closest(".fht-table-wrapper").show(),$.isFunction(arg1)&&arg1.call(this),self)},hide:function(arg1,arg2,arg3){var $self=$(this),self=this,$wrapper=$self.closest(".fht-table-wrapper");return"undefined"!=typeof arg1&&"number"==typeof arg1?($wrapper.hide(arg1,function(){$.isFunction(arg3)&&arg3.call(this)}),self):"undefined"!=typeof arg1&&"string"==typeof arg1&&"undefined"!=typeof arg2&&"number"==typeof arg2?($wrapper.hide(arg1,arg2,function(){$.isFunction(arg3)&&arg3.call(this)}),self):($self.closest(".fht-table-wrapper").hide(),$.isFunction(arg3)&&arg3.call(this),self)},destroy:function(){var $self=$(this),self=this,$wrapper=$self.closest(".fht-table-wrapper");return $self.insertBefore($wrapper).removeAttr("style").append($wrapper.find("tfoot")).removeClass("fht-table fht-table-init").find(".fht-cell").remove(),$wrapper.remove(),self}},helpers={_isTable:function($obj){var $self=$obj,hasTable=$self.is("table"),hasThead=$self.find("thead").length>0,hasTbody=$self.find("tbody").length>0;return!!(hasTable&&hasThead&&hasTbody)},_bindScroll:function($obj){var $self=$obj,$wrapper=$self.closest(".fht-table-wrapper"),$thead=$self.siblings(".fht-thead"),$tfoot=$self.siblings(".fht-tfoot");$self.bind("scroll",function(){if(settings.fixedColumns>0){var $fixedColumns=$wrapper.find(".fht-fixed-column");$fixedColumns.find(".fht-tbody table").css({"margin-top":-$self.scrollTop()})}$thead.find("table").css({"margin-left":-this.scrollLeft}),(settings.footer||settings.cloneHeadToFoot)&&$tfoot.find("table").css({"margin-left":-this.scrollLeft})})},_fixHeightWithCss:function($obj,tableProps){settings.includePadding?$obj.css({height:$obj.height()+tableProps.border}):$obj.css({height:$obj.parent().height()+tableProps.border})},_fixWidthWithCss:function($obj,tableProps,width){settings.includePadding?$obj.each(function(){$(this).css({width:void 0==width?$(this).width()+tableProps.border:width+tableProps.border})}):$obj.each(function(){$(this).css({width:void 0==width?$(this).parent().width()+tableProps.border:width+tableProps.border})})},_setupFixedColumn:function($obj,obj,tableProps){var $firstThChildren,$firstTdChildren,fixedColumnWidth,$newRow,firstTdChildrenSelector,$self=$obj,$wrapper=$self.closest(".fht-table-wrapper"),$fixedBody=$wrapper.find(".fht-fixed-body"),$fixedColumn=$wrapper.find(".fht-fixed-column"),$thead=$('<div class="fht-thead"><table class="fht-table"><thead><tr></tr></thead></table></div>'),$tbody=$('<div class="fht-tbody"><table class="fht-table"><tbody></tbody></table></div>'),$tfoot=$('<div class="fht-tfoot"><table class="fht-table"><tfoot><tr></tr></tfoot></table></div>'),fixedBodyWidth=$wrapper.width(),fixedBodyHeight=$fixedBody.find(".fht-tbody").height()-settings.scrollbarOffset;$thead.find("table.fht-table").addClass(settings.originalTable.attr("class")),$tbody.find("table.fht-table").addClass(settings.originalTable.attr("class")),$tfoot.find("table.fht-table").addClass(settings.originalTable.attr("class")),$firstThChildren=$fixedBody.find(".fht-thead thead tr > *:lt("+settings.fixedColumns+")"),fixedColumnWidth=settings.fixedColumns*tableProps.border,$firstThChildren.each(function(){fixedColumnWidth+=$(this).outerWidth(!0)}),helpers._fixHeightWithCss($firstThChildren,tableProps),helpers._fixWidthWithCss($firstThChildren,tableProps);var tdWidths=[];$firstThChildren.each(function(){tdWidths.push($(this).width())}),firstTdChildrenSelector="tbody tr > *:not(:nth-child(n+"+(settings.fixedColumns+1)+"))",$firstTdChildren=$fixedBody.find(firstTdChildrenSelector).each(function(index){helpers._fixHeightWithCss($(this),tableProps),helpers._fixWidthWithCss($(this),tableProps,tdWidths[index%settings.fixedColumns])}),$thead.appendTo($fixedColumn).find("tr").append($firstThChildren.clone(settings.cloneEvents)),$tbody.appendTo($fixedColumn).css({"margin-top":-1,height:fixedBodyHeight+tableProps.border}),$firstTdChildren.each(function(index){index%settings.fixedColumns==0&&($newRow=$("<tr></tr>").appendTo($tbody.find("tbody")),settings.altClass&&$(this).parent().hasClass(settings.altClass)&&$newRow.addClass(settings.altClass)),$(this).clone(settings.cloneEvents).appendTo($newRow)}),$fixedColumn.css({height:0,width:fixedColumnWidth});var maxTop=$fixedColumn.find(".fht-tbody .fht-table").height()-$fixedColumn.find(".fht-tbody").height();if($fixedColumn.find(".fht-tbody .fht-table").bind("mousewheel",function(event,delta,deltaX,deltaY){if(0!=deltaY){var top=parseInt($(this).css("marginTop"),10)+(deltaY>0?120:-120);return top>0&&(top=0),top<-maxTop&&(top=-maxTop),$(this).css("marginTop",top),$fixedBody.find(".fht-tbody").scrollTop(-top).scroll(),!1}}),$fixedBody.css({width:fixedBodyWidth}),1==settings.footer||1==settings.cloneHeadToFoot){var footwidth,$firstTdFootChild=$fixedBody.find(".fht-tfoot tr > *:lt("+settings.fixedColumns+")");helpers._fixHeightWithCss($firstTdFootChild,tableProps),$tfoot.appendTo($fixedColumn).find("tr").append($firstTdFootChild.clone(settings.cloneEvents)),footwidth=$tfoot.find("table").innerWidth(),$tfoot.css({top:settings.scrollbarOffset,width:footwidth})}},_setupTableFooter:function($obj,obj,tableProps){var $self=$obj,$wrapper=$self.closest(".fht-table-wrapper"),$tfoot=$self.find("tfoot"),$divFoot=$wrapper.find("div.fht-tfoot");switch($divFoot.length||($divFoot=settings.fixedColumns>0?$('<div class="fht-tfoot"><table class="fht-table"></table></div>').appendTo($wrapper.find(".fht-fixed-body")):$('<div class="fht-tfoot"><table class="fht-table"></table></div>').appendTo($wrapper)),$divFoot.find("table.fht-table").addClass(settings.originalTable.attr("class")),!0){case!$tfoot.length&&1==settings.cloneHeadToFoot&&1==settings.footer:var $divHead=$wrapper.find("div.fht-thead");$divFoot.empty(),$divHead.find("table").clone(settings.cloneEvents).appendTo($divFoot);break;case $tfoot.length&&0==settings.cloneHeadToFoot&&1==settings.footer:$divFoot.find("table").append($tfoot).css({"margin-top":-tableProps.border}),helpers._setupClone($divFoot,tableProps.tfoot)}},_getTableProps:function($obj){var tableProp={thead:{},tbody:{},tfoot:{},border:0},borderCollapse=1;return 1==settings.borderCollapse&&(borderCollapse=2),tableProp.border=($obj.find("th:first-child").outerWidth()-$obj.find("th:first-child").innerWidth())/borderCollapse,$obj.find("thead tr:first-child > *").each(function(index){tableProp.thead[index]=$(this).width()+tableProp.border}),$obj.find("tfoot tr:first-child > *").each(function(index){tableProp.tfoot[index]=$(this).width()+tableProp.border}),$obj.find("tbody tr:first-child > *").each(function(index){tableProp.tbody[index]=$(this).width()+tableProp.border}),tableProp},_setupClone:function($obj,cellArray){var $cell,$self=$obj,selector=$self.find("thead").length?"thead tr:first-child > *":$self.find("tfoot").length?"tfoot tr:first-child > *":"tbody tr:first-child > *";$self.find(selector).each(function(index){if($cell=$(this).find("div.fht-cell").length?$(this).find("div.fht-cell"):$('<div class="fht-cell"></div>').appendTo($(this)),$cell.css({width:parseInt(cellArray[index],10)}),!$(this).closest(".fht-tbody").length&&$(this).is(":last-child")&&!$(this).closest(".fht-fixed-column").length){var padding=Math.max(($(this).innerWidth()-$(this).width())/2,settings.scrollbarOffset);$(this).css({"padding-right":parseInt($(this).css("padding-right"))+padding+"px"})}})},_isPaddingIncludedWithWidth:function(){var defaultHeight,newHeight,$obj=$('<table class="fht-table"><tr><td style="padding: 10px; font-size: 10px;">test</td></tr></table>');return $obj.addClass(settings.originalTable.attr("class")),$obj.appendTo("body"),defaultHeight=$obj.find("td").height(),$obj.find("td").css("height",$obj.find("tr").height()),newHeight=$obj.find("td").height(),$obj.remove(),defaultHeight!=newHeight},_getScrollbarWidth:function(){var scrollbarWidth=0;if(!scrollbarWidth)if(/msie/.test(navigator.userAgent.toLowerCase())){var $textarea1=$('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body"),$textarea2=$('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body");scrollbarWidth=$textarea1.width()-$textarea2.width()+2,$textarea1.add($textarea2).remove()}else{var $div=$("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:-1e3}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200});scrollbarWidth=100-$div.width(),$div.parent().remove()}return scrollbarWidth}};return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error('Method "'+method+'" does not exist in fixedHeaderTable plugin!'):methods.init.apply(this,arguments)}}(jQuery);